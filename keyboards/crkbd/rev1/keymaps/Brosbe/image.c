
static const char PROGMEM murkoff_logo[] = {// 'Murkoff logo_standalone', 32x32px
0x06, 0x1e, 0x7e, 0xfe, 0xfe, 0xce, 0x0e, 0x0e, 0x0e, 0x0e, 0x0e, 0x0e, 0x0e, 0x0e, 0xce, 0xce,
0xce, 0xce, 0xce, 0xce, 0xce, 0xce, 0xce, 0xce, 0xce, 0xce, 0xce, 0xce, 0xce, 0xce, 0xc6, 0xc2,
0x00, 0x00, 0x00, 0x01, 0x07, 0x1f, 0x7f, 0xfc, 0xf0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff,
0xff, 0xff, 0x01, 0x01, 0x01, 0xff, 0xff, 0xff, 0xff, 0x01, 0x01, 0x01, 0xff, 0xff, 0xff, 0xff,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x07, 0x1f, 0x7f, 0xfc, 0xf0, 0xc0, 0xff, 0xff,
0xff, 0xff, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x3f, 0x00, 0x00, 0x00, 0x3f, 0x1f, 0x07, 0x01,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x07, 0x1f, 0x3f, 0x1f,
0x0f, 0x03, 0x00, 0x00, 0x00, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

static const char PROGMEM corner[] = {// 'corner', 5x16px
0x00, 0x00, 0xf0, 0x18, 0x0c, 0x00, 0x00, 0xff, 0x00, 0x00};

static const char PROGMEM home_layer_icon_top[] = {// 'home top', 11x16px
0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x84, 0xc4, 0xc4, 0x80, 0xc0, 0xe0, 0xf0, 0xf8,
0xfc, 0xfe, 0xff, 0xff, 0xff, 0xff};

static const char PROGMEM home_layer_icon_bottom[] = {// 'home bottom', 11x16px
0x00, 0x00, 0x00, 0xff, 0xff, 0xc7, 0xc7, 0xff, 0xff, 0x0f, 0x0f, 0x20, 0x20, 0x20, 0x23, 0x23,
0x23, 0x23, 0x23, 0x23, 0x20, 0x20};

static const char PROGMEM prog_layer_icon[] ={// 'prog_part', 11x16px
0x04, 0x04, 0x04, 0x04, 0x04, 0xc4, 0xe4, 0x64, 0x24, 0x04, 0x04, 0x00, 0x00, 0x80, 0x80, 0xc0,
0x7f, 0x3f, 0x00, 0x00, 0x00, 0x00};

static const char PROGMEM num_layer_icon[] = {// 'num_ layer_full', 22x32px
0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04,
0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x00, 0x00, 0x00, 0x7c, 0x08, 0x10, 0x20, 0x7c, 0x00, 0x3c,
0x40, 0x40, 0x3c, 0x00, 0x7c, 0x08, 0x10, 0x08, 0x7c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x1f, 0x05, 0x05, 0x02, 0x00, 0x1e, 0x05, 0x05, 0x1e, 0x00, 0x1f, 0x11, 0x11, 0x0e, 0x00, 0x00,
0x00, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20};

static const char PROGMEM func_layer_icon[] = {// 'func_layer_full', 22x32px
0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x84, 0xe4, 0xf4, 0x74, 0xf4, 0xf4,
0xf4, 0xe4, 0x04, 0x04, 0x04, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0xfe,
0xff, 0xff, 0xff, 0x18, 0x18, 0x19, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x80, 0x80, 0x00, 0xf0, 0xff, 0xff, 0x3f, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x20, 0x20, 0x20, 0x20, 0x23, 0x27, 0x27, 0x27, 0x27, 0x27, 0x23, 0x20, 0x20, 0x20,
0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20};

static const char PROGMEM macro_layer_icon_top[] = {// 'Macro Top', 11x16px
0x04, 0x04, 0x04, 0x04, 0x84, 0x84, 0xc4, 0xc4, 0xe4, 0xe4, 0xe4, 0xe0, 0xf8, 0xfe, 0xff, 0xff,
0xff, 0x0f, 0x0f, 0x3f, 0x3f, 0xff};

static const char PROGMEM macro_layer_icon_bottom[] = {// 'Macro Bottom', 11x16px
0x07, 0x1f, 0x7f, 0xff, 0xff, 0xff, 0xf0, 0xf0, 0xff, 0xff, 0xfc, 0x20, 0x20, 0x20, 0x20, 0x21,
0x21, 0x23, 0x23, 0x27, 0x27, 0x27};

static const char PROGMEM nav_layer_icon_top[] = {// 'nav_top', 11x16px
0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00,
0xf0, 0xfc, 0xfe, 0xfe, 0x9f, 0x0f};

static const char PROGMEM nav_layer_icon_bottom[] = {// 'nav_bottom', 11x16px
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x07, 0x1f, 0x7f, 0xff, 0x20, 0x20, 0x20, 0x20, 0x20,
0x20, 0x20, 0x20, 0x20, 0x20, 0x20};

static const char PROGMEM inter_layer_icon[] = {// 'inter_layer_full', 22x32px
0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x84, 0x84, 0x84, 0x84, 0x84, 0x04, 0x04,
0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x00, 0x00, 0xc0, 0xf0, 0x9c, 0x16, 0x7b, 0x9d, 0x8d, 0x8f,
0x03, 0x00, 0x01, 0x41, 0x6f, 0xf7, 0xf2, 0xf4, 0xc8, 0xf0, 0xc0, 0x00, 0x00, 0x00, 0x03, 0x0f,
0x38, 0x60, 0x40, 0x83, 0x87, 0x7f, 0xbf, 0x0f, 0x02, 0x00, 0x80, 0xc0, 0x43, 0x6f, 0x37, 0x0f,
0x03, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x21, 0x21, 0x21, 0x21, 0x21, 0x21,
0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20};

static const char PROGMEM gaming_layer_icon[] = {// 'gaming_layer_full', 22x32px
0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04,
0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0xc0, 0xf0, 0xfc, 0xfe, 0xcf, 0xcf, 0xff, 0x7e, 0x7c, 0xfc,
0xcc, 0xcc, 0xfc, 0xfc, 0x9e, 0x9f, 0x67, 0x67, 0x9e, 0x9c, 0xf0, 0xc0, 0x07, 0x3f, 0xff, 0xff,
0xff, 0xff, 0x7c, 0x18, 0x08, 0x0c, 0x0f, 0x0f, 0x0c, 0x0c, 0x1f, 0x7f, 0xfe, 0xfe, 0xff, 0xff,
0x3f, 0x07, 0x20, 0x20, 0x20, 0x21, 0x21, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
0x20, 0x20, 0x20, 0x21, 0x21, 0x20, 0x20, 0x20};

static const char PROGMEM shift_icon[] = {// 'shft_small', 16x16px
0x00, 0xf8, 0x0c, 0x06, 0x02, 0x62, 0x92, 0x92, 0x12, 0x12, 0x22, 0x02, 0x06, 0x0c, 0xf8, 0x00,
0x00, 0x1f, 0x30, 0x60, 0x40, 0x44, 0x48, 0x48, 0x49, 0x49, 0x46, 0x40, 0x60, 0x30, 0x1f, 0x00};

static const char PROGMEM ctrl_icon[] = {// 'ctrl_small', 16x16px
0x00, 0xf8, 0x0c, 0x06, 0x02, 0xc2, 0x22, 0x22, 0x22, 0x22, 0x42, 0x02, 0x06, 0x0c, 0xf8, 0x00,
0x00, 0x1f, 0x30, 0x60, 0x40, 0x43, 0x44, 0x44, 0x44, 0x44, 0x42, 0x40, 0x60, 0x30, 0x1f, 0x00};

static const char PROGMEM alt_icon[] = {// 'alt_small', 16x16px
0x00, 0xf8, 0x0c, 0x06, 0x02, 0xc2, 0x22, 0x22, 0x22, 0x22, 0xc2, 0x02, 0x06, 0x0c, 0xf8, 0x00,
0x00, 0x1f, 0x30, 0x60, 0x40, 0x47, 0x41, 0x41, 0x41, 0x41, 0x47, 0x40, 0x60, 0x30, 0x1f, 0x00};

static const char PROGMEM mod_icon[] = {// 'mod_small', 16x16px
0x00, 0xf8, 0x0c, 0x06, 0x02, 0xe2, 0x42, 0x82, 0x82, 0x42, 0xe2, 0x02, 0x06, 0x0c, 0xf8, 0x00,
0x00, 0x1f, 0x30, 0x60, 0x40, 0x47, 0x40, 0x40, 0x40, 0x40, 0x47, 0x40, 0x60, 0x30, 0x1f, 0x00};

static char screen[512];

static char last_modifiers = 255;
static int last_layer = 255;

//le big yoink
static unsigned char lookup_bytes[16] = {
0x0, 0x8, 0x4, 0xc, 0x2, 0xa, 0x6, 0xe,
0x1, 0x9, 0x5, 0xd, 0x3, 0xb, 0x7, 0xf, };

uint8_t reverse(uint8_t n) {
   return (lookup_bytes[n&0b1111] << 4) | lookup_bytes[n>>4];
}
//thanks to stackoverflow for this kind of stuff

static void renderLogo(void){
    oled_write_raw_P(murkoff_logo, sizeof(murkoff_logo));
}

// static void merge_arrays(const char array_1[], const char array_2[], char array_3[], char result[], int image_1_length, int image_2_length){

//     int new_length = image_1_length + image_2_length;

//     int i;
//     for(i = 0; i < image_1_length; i++)
//     {
//         result[i] = array_1[i];
//     }

//     int j;

//     for(i = 0, j = image_1_length; j < new_length; i++, j++)
//     {
//         result[j] = array_2[i];
//     }

//     for(i = 0; j < new_length + 128; i++, j++)
//     {
//         result[j] = array_3[i];
//     }

// }

static void add_default_small_icons(char modifiers, int screen_index){
    int i = screen_index;
    int j = 0;

    for(unsigned char loop = 0; loop < 2; loop++)
    {
        for(unsigned char l = 0; l < 16; i++, l++, j++)
        {
            screen[i] =  modifiers & MOD_MASK_SHIFT ? shift_icon[j] : 0x00;
            screen[i+16] =  modifiers & MOD_MASK_CTRL ? ctrl_icon[j] : 0x00;
            screen[i+64] =  modifiers & MOD_MASK_ALT ? alt_icon[j] : 0x00;
            screen[i+80] =  modifiers & MOD_MASK_GUI ? mod_icon[j] : 0x00;
        }
        i = screen_index + 32;
    }
}

static void render_two_part_icon(const char top[], const char bottom[], int screen_index){
    unsigned char i,j,k;
    int l;
    k = sizeof(home_layer_icon_top) >> 1;

    for(i=0, l=screen_index,j = 21; i < k; i++, l++, j--)
    {
        screen[l] = top[i];
        screen[l+11] = top[j-11];
        screen[l+32] = top[i+11];
        screen[l+43] = top[j];
    }

    for(i=0, l=screen_index + 64, j=21; i < k; i++, l++, j--)
    {
        screen[l] = bottom[i];
        screen[l+11] = bottom[j-11];
        screen[l+32] = bottom[i+11];
        screen[l+43] = bottom[j];
    }
}

static void render_one_part_icon(const char icon[], int screen_index){
    unsigned char i,j,k;
    int l;
    k = sizeof(prog_layer_icon) >> 1;

    for(i=0, l=screen_index,j = 21; i < k; i++, l++, j--)
    {
        screen[l] = icon[i];
        screen[l+11] = icon[j-11];
        screen[l+32] = icon[i+11];
        screen[l+43] = icon[j];
    }

    for(i=0, l=screen_index + 64,j = 21; i < k; i++, l++, j--)
    {
        screen[l] = reverse(icon[i+11]);
        screen[l+11] = reverse(icon[j]);
        screen[l+32] = reverse(icon[i]);
        screen[l+43] = reverse(icon[j-11]);
    }
}

static void render_big_icon(const char icon[], int screen_index){
    unsigned char i,j,m;
    m=0;
    int k = sizeof(inter_layer_icon);
    int l = screen_index;


    for(i=0, j=0; i < k; i++, j++, l++){
        if(j == 22)
        {
            m++;
            j = 0;
            l = screen_index + 32 * m;
        }
        screen[l] = icon[i];
    }
}

void set_layer_icon(int layer)
{
    int image_index = sizeof(murkoff_logo) + 5;
    switch(layer){
        case 1:
            render_one_part_icon(prog_layer_icon, image_index);
            break;
        case 2:
            render_big_icon(num_layer_icon, image_index);
            break;
        case 3:
            render_big_icon(func_layer_icon, image_index);
            break;
        case 4:
            render_two_part_icon(macro_layer_icon_top, macro_layer_icon_bottom, image_index);
            break;
        case 5:
            render_two_part_icon(nav_layer_icon_top, nav_layer_icon_bottom, image_index);
            break;
        case 6:
            render_big_icon(inter_layer_icon, image_index);
            break;
        case 7:
            render_big_icon(gaming_layer_icon, image_index);
            break;
        default:
            render_two_part_icon(home_layer_icon_top, home_layer_icon_bottom, image_index);
            //render_chimney()
            break;
    }
}

void show_oled(int layer, char modifiers){
    bool changed = false;
    if (layer != last_layer )
    {
        set_layer_icon(layer);
        changed = true;
        last_layer = layer;
    }
    if (modifiers != last_modifiers)
    {
        add_default_small_icons(modifiers, sizeof(murkoff_logo) << 1);
        changed = true;
        last_modifiers = modifiers;
    }
    if(changed)
    {
        oled_write_raw_P(screen, sizeof(screen));
    }
}
static void init_oled_layout(void){

    int i = 0;
    int j, k;
    for(i = 0; i < sizeof(murkoff_logo); i++)
    {
        screen[i] = murkoff_logo[i];
    }


    for(j = 0, k = sizeof(corner)-1; j < sizeof(corner) >> 1; j++, k--, i++)
    {
        screen[i] = corner[j];
        screen[i+27] = corner[k-5];
        screen[i+32] = corner[k];
        screen[i+59] = corner[j+5];
    }

    for(j = 0, k = sizeof(corner)-1, i=sizeof(murkoff_logo)+64; j < sizeof(corner) >> 1; j++, k--, i++)
    {
        screen[i] = corner[j+5];
        screen[i+27] = corner[k];
        screen[i+32] = reverse(corner[j]);
        screen[i+59] = reverse(corner[k-5]);
    }

    show_oled(0,0);

}
